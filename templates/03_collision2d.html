{%  extends 'base.html' %}
{% block content %}
  <script>
    document.getElementById("prev-link").href="/02_spring";
    document.getElementById("next-link").href="/04_collision_pendulum";
    document.getElementById("desc-span").innerHTML="3/8";
  </script>

  <header id='overview'>
    <h1>시뮬레이션 3. 2차원 충돌</h1>
    <p class="headerDescription">
      "물리 엔진이란, 게임 등에서 물체의 움직임을 관할하는 프로그램이다. 절대로 자동차 엔진처럼 생긴 게 컴퓨터에서 뭔 짓 거리 하는게 아니다. 종종 엔진이라는 용어 하나로 엉뚱한 데로 가는 사람이 있다. 대표적으로 크게 두 가지가 있는데 하프 라이프2, 컴퍼니 오브 히어로즈 등에 채용된 인텔의 하복 엔진, 그리고 언리얼 엔진 3을 사용한 게임들로부터 자주 볼 수 있는 엔비디아의 피직스 엔진이 있다. 이것 외에도 NHN NEXT Physics Engine 이 있다."
    </p>
  </header>
  <hr>
  <div id="engine-container">
    <div id="gui-container"></div>
    <canvas id="canvas" width="800px" height="600px"></canvas>
  </div>

  <script type="text/javascript" src="../static/js/npengine.dev.js"></script>
  <script type="text/javascript" src="../static/js/dat.gui.min.js"></script>
  <script type="text/javascript">
    var eleCanvas = document.getElementById("canvas");
    var engine = new NPEngine(eleCanvas);
    var grid = new NPEngine.Grid;
    var collision = new NPEngine.Collision2d;
    engine.setGrid(grid);
    engine.addDisplayObject(collision);
    engine.ready();

    // default value
    var DefaultValue = function () {
      this.mass1 = 2;
      this.mass2 = 2;
      this.k = 10000;
      this.mu = 50;
      this.diameter1 = 1;
      this.diameter2 = 1;
      this.ball1_x = -1;
      this.ball1_y = 1;
      this.ball2_x = 1;
      this.ball2_y = 0;
      this.velocity1_x = 1;
      this.velocity1_y = 0;
      this.velocity2_x = 0;
      this.velocity2_y = 0;
    };

    window.onload = function () {
      var defaultValue = new DefaultValue();
      var gui = new dat.GUI();
      var container = document.getElementById("gui-container");
      container.appendChild(gui.domElement);

      var massFolder = gui.addFolder('질량 (Kg)');
      massFolder.open();
      var mass1 = massFolder.add(defaultValue, 'mass1');
      mass1.onChange(function (value) {
        engine.stop();
        collision.setMass1(Math.round(value));
        engine.ready();
      });

      var mass2 = massFolder.add(defaultValue, 'mass2');
      mass2.onChange(function (value) {
        engine.stop();
        collision.setMass2(Math.round(value));
        engine.ready();
      });

      var kFolder = gui.addFolder('K (N/m)');
      kFolder.open();
      var k = kFolder.add(defaultValue, 'k');
      k.onChange(function (value) {
        engine.stop();
        collision.setK(Math.round(value));
        engine.ready();
      });

      var muFolder = gui.addFolder('Mu (N*s/m)');
      muFolder.open();
      var mu = muFolder.add(defaultValue, 'mu');
      mu.onChange(function (value) {
        engine.stop();
        collision.setMu(Math.round(value));
        engine.ready();
      });

      var diameterFolder = gui.addFolder('지름 (m)');
      diameterFolder.open();
      var diameter1 = diameterFolder.add(defaultValue, 'diameter1');
      diameter1.onChange(function (value) {
        engine.stop();
        collision.setDiameter1(value);
        engine.ready();
      });

      var diameter2 = diameterFolder.add(defaultValue, 'diameter2');
      diameter2.onChange(function (value) {
        engine.stop();
        collision.setDiameter2(value);
        engine.ready();
      });

      var positionFolder = gui.addFolder('공의 초기 위치 (m)');
      positionFolder.open();
      var ball1_x = positionFolder.add(defaultValue, 'ball1_x');
      ball1_x.onChange(function (value) {
        engine.stop();
        collision.setBall1_x(value);
        engine.ready();
      });

      var ball1_y = positionFolder.add(defaultValue, 'ball1_y');
      ball1_y.onChange(function (value) {
        engine.stop();
        collision.setBall1_y(value);
        engine.ready();
      });

      var ball2_x = positionFolder.add(defaultValue, 'ball2_x');
      ball2_x.onChange(function (value) {
        engine.stop();
        collision.setBall2_x(value);
        engine.ready();
      });

      var ball2_y = positionFolder.add(defaultValue, 'ball2_y');
      ball2_y.onChange(function (value) {
        engine.stop();
        collision.setBall2_y(value);
        engine.ready();
      });

      var velocityFolder = gui.addFolder('공의 초기 속도 (m/s)');
      velocityFolder.open();
      var velocity1_x = velocityFolder.add(defaultValue, 'velocity1_x');
      velocity1_x.onChange(function (value) {
        engine.stop();
        collision.setVelocity1_x(value);
        engine.ready();
      });

      var velocity1_y = velocityFolder.add(defaultValue, 'velocity1_y');
      velocity1_y.onChange(function (value) {
        engine.stop();
        collision.setVelocity1_y(value);
        engine.ready();
      });

      var velocity2_x = velocityFolder.add(defaultValue, 'velocity2_x');
      velocity2_x.onChange(function (value) {
        engine.stop();
        collision.setVelocity2_x(value);
        engine.ready();
      });

      var velocity2_y = velocityFolder.add(defaultValue, 'velocity2_y');
      velocity2_y.onChange(function (value) {
        engine.stop();
        collision.setVelocity2_y(value);
        engine.ready();
      });
    };
  </script>
{% endblock %}
